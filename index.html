<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Jeu de plateau</title>
<style>
  body { margin: 0; font-family: Arial, sans-serif; background: #222; color: #fff; }
  #plateau { position: relative; width: 600px; height: 600px; margin: 20px auto; background: url('https://raw.githubusercontent.com/stephanelavallee89-crypto/Mon-jeux-/main/plateau%20jeux.jpg') no-repeat center/contain; }
  .pion { width: 40px; height: 40px; border-radius: 50%; position: absolute; text-align:center; line-height:40px; font-size:20px; font-weight:bold; }
  #bandeau { width: 600px; margin: 10px auto; background: #000; padding: 10px; min-height: 60px; text-align:center; }
  #controls { width: 600px; margin: 10px auto; text-align:center; }
  button { margin: 5px; padding: 5px 10px; }
  #popup { position: absolute; background: rgba(0,0,0,0.8); padding: 10px; border-radius: 5px; display:none; color:#fff; font-size:18px; text-align:center; }
</style>
</head>
<body>

<div id="plateau"></div>
<div id="bandeau">Bienvenue ! Cliquez sur Start pour commencer.</div>
<div id="controls">
  Joueurs: 
  <select id="nb-joueurs">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
  </select>
  <button id="start">Start</button>
  <button id="lancer-de">Lancer Dé</button>
  <button id="reset">Reset</button>
  <button id="volume">Mute/Unmute</button>
  <button id="gagne-perdu">Gagné / Perdu</button>
  <div id="de-container">Dé: 0</div>
  <div id="tour-joueur">Tour: -</div>
</div>

<div id="popup"></div>

<script>
const positions = {
  1: {x:0, y:0}, 2:{x:120,y:0},3:{x:240,y:0},4:{x:360,y:0},5:{x:480,y:0},
  6:{x:480,y:120},7:{x:480,y:240},8:{x:480,y:360},9:{x:480,y:480},10:{x:360,y:480},
  11:{x:240,y:480},12:{x:120,y:480},13:{x:0,y:480},14:{x:0,y:360},15:{x:0,y:240},
  16:{x:0,y:120},17:{x:120,y:120},18:{x:240,y:120},19:{x:360,y:120},20:{x:360,y:240},
  21:{x:360,y:360},22:{x:240,y:360},23:{x:120,y:360},24:{x:120,y:240},25:{x:240,y:240}
};

const actions = {
  1: "Tout le monde se sert à boire !",
  2: "Fredonne la chanson que te souffle le joueur à ta droite",
  3: "Embrasse le joueur à ta droite",
  4: "Pose une colle au joueur de ton choix",
  5: "Tout le monde trinque",
  6: "Echange un vêtement avec le joueur à ta gauche",
  7: "Mime ce que te souffle le joueur de droite",
  8: "Choisi le joueur qui doit te faire un massage",
  9: "Echange ton verre avec le joueur à ta droite",
  10:"Désigne ton joueur favori",
  11:"Retour à la case départ !",
  12:"Dessine ce que te souffle le joueur à ta gauche",
  13:"Pose une colle au joueur de ton choix",
  14:"Embrasse le joueur à ta gauche",
  15:"Echange un vêtement avec le joueur à ta droite",
  16:"Passe ton tour ! Et bois un coup",
  17:"Echange ton verre avec le joueur à ta gauche",
  18:"Dessine ce que te souffle le joueur à ta droite",
  19:"Avance de 3 cases",
  20:"Fredonne la chanson que te souffle le joueur à ta gauche",
  21:"Pose une question osée au joueur de ton choix",
  22:"Cul sec !",
  23:"Mime ce que te souffle le joueur à ta gauche",
  24:"Pose une colle au joueur de ton choix",
  25:"Tu as gagné le droit de demander le service que tu veux"
};

const reculeTrois = [3,2,7,12,13,18];
const avanceTrois = [19];
const retourDepart = [11];
const passeTour = [16];

let joueurs = [];
let nbJoueurs = 0;
let tour = 0;
let positionsJoueurs = {};
let skipNext = {};

const plateau = document.getElementById("plateau");
const bandeau = document.getElementById("bandeau");
const popup = document.getElementById("popup");
const deContainer = document.getElementById("de-container");
const tourContainer = document.getElementById("tour-joueur");
const btnGagne = document.getElementById("gagne-perdu");

document.getElementById("start").addEventListener("click",()=>{
  nbJoueurs = parseInt(document.getElementById("nb-joueurs").value);
  plateau.innerHTML="";
  joueurs=[];
  positionsJoueurs={};
  skipNext={};
  for(let i=1;i<=nbJoueurs;i++){
    const pion = document.createElement("div");
    pion.classList.add("pion");
    pion.style.backgroundColor=`hsl(${i*60},70%,50%)`;
    pion.textContent=i;
    plateau.appendChild(pion);
    joueurs.push(pion);
    positionsJoueurs[i]=1;
    pion.style.left = positions[1].x + i*10 + "px";
    pion.style.top = positions[1].y + i*10 + "px";
    skipNext[i]=false;
  }
  tour=1;
  tourContainer.textContent = "Tour: Joueur "+tour;
  afficherAction(1);
});

document.getElementById("lancer-de").addEventListener("click",()=>{
  if(nbJoueurs==0) return;
  let joueurActuel = tour;
  if(skipNext[joueurActuel]){
    skipNext[joueurActuel]=false;
    tourSuivant();
    return;
  }
  const de = Math.floor(Math.random()*6)+1;
  deContainer.textContent = "Dé: "+de;
  let pos = positionsJoueurs[joueurActuel];
  let newPos = pos + de;

  if(avanceTrois.includes(pos)) newPos = pos+3;
  if(newPos>25) newPos=25;
  if(retourDepart.includes(newPos)) newPos = 1;
  if(passeTour.includes(newPos)) skipNext[joueurActuel]=true;

  positionsJoueurs[joueurActuel]=newPos;
  const pion = joueurs[joueurActuel-1];
  pion.style.left = positions[newPos].x + joueurActuel*10 + "px";
  pion.style.top = positions[newPos].y + joueurActuel*10 + "px";

  let actionText = actions[newPos];
  if(reculeTrois.includes(newPos)) actionText += " et recule de trois cases";

  afficherAction(newPos, actionText);
  tourSuivant();
});

function tourSuivant(){
  tour = (tour%nbJoueurs)+1;
  tourContainer.textContent = "Tour: Joueur "+tour;
}

document.getElementById("reset").addEventListener("click",()=>{
  plateau.innerHTML="";
  bandeau.textContent="Bienvenue ! Cliquez sur Start pour commencer.";
  deContainer.textContent="Dé: 0";
  tourContainer.textContent="Tour: -";
});

btnGagne.addEventListener("click",()=>{
  let joueurActuel = tour-1;
  if(joueurActuel===0) joueurActuel=nbJoueurs;
  let pos = positionsJoueurs[joueurActuel];
  let recule = reculeTrois.includes(pos);
  let gagne = confirm("Le joueur a-t-il réussi ? OK = Gagné, Annuler = Perdu");
  if(recule && !gagne){
    positionsJoueurs[joueurActuel] = Math.max(1, pos-3);
    const pion = joueurs[joueurActuel-1];
    pion.style.left = positions[positionsJoueurs[joueurActuel]].x + joueurActuel*10 + "px";
    pion.style.top = positions[positionsJoueurs[joueurActuel]].y + joueurActuel*10 + "px";
    afficherAction(positionsJoueurs[joueurActuel], actions[positionsJoueurs[joueurActuel]]);
  }
});

function afficherAction(caseNum, texte=null){
  bandeau.textContent = texte || actions[caseNum];
  popup.textContent = texte || actions[caseNum];
  popup.style.left = positions[caseNum].x+60+"px";
  popup.style.top = positions[caseNum].y+60+"px";
  popup.style.display="block";
  setTimeout(()=>{popup.style.display="none";},4000);
}
</script>
</body>
</html>
