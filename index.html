<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Party Game - Plateau</title>
<style>
  :root{
    --bg: #0b0b0b;
    --panel: #0f0f0f;
    --accent: #f1c40f;
    --text: #eee;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter,Arial,Helvetica,sans-serif}
  .container{max-width:1100px;margin:14px auto;padding:12px;box-sizing:border-box;display:flex;gap:12px;align-items:flex-start}
  /* Board area */
  .left{flex:1;display:flex;flex-direction:column;align-items:center;gap:12px}
  #boardWrap{position:relative;width:800px;height:600px;border-radius:8px;overflow:hidden;background:#000}
  #board{width:100%;height:100%;object-fit:contain;display:block}
  /* popup on board */
  .board-popup{position:absolute;transform:translate(-50%,-120%);background:rgba(0,0,0,0.9);padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);display:none;z-index:60;min-width:180px;text-align:center}
  .board-popup h4{margin:0 0 6px 0;color:var(--accent);font-size:15px}
  .board-popup p{margin:0;font-size:14px}
  /* right panel */
  .right{width:320px;background:linear-gradient(180deg,#0a0a0a,#101010);padding:14px;border-radius:8px;box-shadow:0 6px 20px rgba(0,0,0,.6)}
  .controls{display:flex;flex-direction:column;gap:10px}
  .row{display:flex;gap:8px;align-items:center}
  select,button,input[type=range]{padding:8px;border-radius:8px;background:#0b0b0b;color:var(--text);border:1px solid rgba(255,255,255,.04)}
  button{cursor:pointer}
  .status{background:#070707;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.03);min-height:60px;font-size:14px}
  /* pawn style */
  .pawn{position:absolute;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;z-index:50;box-shadow:0 4px 10px rgba(0,0,0,.6);transition:left .6s ease, top .6s ease}
  /* dice */
  #diceDisplay{font-size:28px;font-weight:700}
  .small{font-size:13px;color:#bbb}
  /* responsive */
  @media(max-width:980px){.container{flex-direction:column;align-items:center}.right{width:100%}}
</style>
</head>
<body>

<div class="container">
  <div class="left">
    <div id="boardWrap">
      <img id="board" src="https://raw.githubusercontent.com/stephanelavallee89-crypto/Mon-jeux-/main/plateau%20jeux.jpg" alt="plateau">
      <!-- popup displayed over cases -->
      <div id="boardPopup" class="board-popup"><h4 id="bpTitle">POP</h4><p id="bpText">texte</p></div>
      <!-- pawns will be appended here -->
    </div>

    <div id="bandeau" class="status">Choisis le nombre de joueurs â†’ assigner puis START</div>
  </div>

  <div class="right">
    <h2 style="margin:0 0 6px 0;color:var(--accent)">Controls</h2>
    <div class="controls">
      <div class="row">
        <label class="small">Joueurs</label>
        <select id="numPlayers"><option>1</option><option>2</option><option selected>3</option><option>4</option><option>5</option><option>6</option></select>
      </div>

      <div class="row" style="justify-content:space-between">
        <button id="startBtn">Start</button>
        <button id="rollBtn" disabled>ðŸŽ² Lancer</button>
        <button id="resetBtn">Reset</button>
      </div>

      <div class="row" style="justify-content:space-between;align-items:center">
        <div style="display:flex;flex-direction:column">
          <label class="small">Volume maÃ®tre</label>
          <input id="vol" type="range" min="0" max="100" value="80">
        </div>
        <div id="diceDisplay">â€”</div>
      </div>

      <div class="row">
        <label class="small">Musique chill</label>
        <button id="playMusicBtn">Play</button>
      </div>

      <div class="status" id="statusBox">Aucun jeu en cours.</div>

      <div style="font-size:13px;color:#bbb">
        Notes :
        <ul style="padding-left:18px;margin:6px 0 0 0">
          <li>Start place tous les pions sur la case 1 (haut-gauche) et dÃ©clenche son action.</li>
          <li>Le dÃ© se lance quand tu cliques sur <em>Lancer</em>. Tour par tour automatique.</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<script>
/* ---------- Configuration (cases spirale + actions + sons) ---------- */
/* board size used for coordinates: 800 x 600 (matching image in CSS) */
const caseCoords = [
  /* 1..25 order by spiral â€” coordinates center adjusted for pawn size */
  {num:1, x:50,  y:45},
  {num:2, x:210, y:45},
  {num:3, x:370, y:45},
  {num:4, x:530, y:45},
  {num:5, x:690, y:45},
  {num:6, x:690, y:165},
  {num:7, x:690, y:285},
  {num:8, x:690, y:405},
  {num:9, x:690, y:525},
  {num:10,x:530, y:525},
  {num:11,x:370, y:525},
  {num:12,x:210, y:525},
  {num:13,x:50,  y:525},
  {num:14,x:50,  y:405},
  {num:15,x:50,  y:285},
  {num:16,x:50,  y:165},
  {num:17,x:210, y:165},
  {num:18,x:370, y:165},
  {num:19,x:530, y:165},
  {num:20,x:530, y:285},
  {num:21,x:530, y:405},
  {num:22,x:370, y:405},
  {num:23,x:210, y:405},
  {num:24,x:370, y:285},
  {num:25,x:370, y:285} // center (25)
];

const caseData = {
  1:{action:"Tout le monde se sert Ã  boire !", popup:"SantÃ© !", son:"https://freesound.org/data/previews/341/341695_6247650-lq.mp3"},
  2:{action:"Fredonne la chanson que te souffle le joueur Ã  ta droite si les autres joueurs ne trouvent pas tu bois :)", popup:"Met l'ambiance !", son:"https://freesound.org/data/previews/341/341698_6247650-lq.mp3"},
  3:{action:"Embrasse le joueur Ã  ta droite", popup:"Smack", son:"https://freesound.org/data/previews/341/341700_6247650-lq.mp3"},
  4:{action:"Pose une colle au joueur de ton choix; s'il perd il boit sinon c'est toi ;)", popup:"Culture G", son:"https://freesound.org/data/previews/341/341702_6247650-lq.mp3"},
  5:{action:"Tout le monde trinque", popup:"Tchin tchin", son:"https://freesound.org/data/previews/341/341705_6247650-lq.mp3"},
  6:{action:"Ã‰change un vÃªtement avec le joueur Ã  ta gauche et faites un selfie", popup:"Ã‰change", son:"https://freesound.org/data/previews/341/341707_6247650-lq.mp3"},
  7:{action:"Mime ce que te souffle le joueur de droite", popup:"Action!", son:"https://freesound.org/data/previews/341/341710_6247650-lq.mp3"},
  8:{action:"Ã‰change ton verre avec le joueur Ã  ta droite", popup:"C'est bon... ou pas !", son:"https://freesound.org/data/previews/341/341715_6247650-lq.mp3"},
  9:{action:"Ã‰change ton verre avec le joueur Ã  ta droite (variante)", popup:"C'est bon... ou pas !", son:"https://freesound.org/data/previews/341/341718_6247650-lq.mp3"},
  10:{action:"DÃ©signe ton joueur favori", popup:"Love", son:"https://freesound.org/data/previews/341/341720_6247650-lq.mp3"},
  11:{action:"Retour Ã  la case dÃ©part !", popup:"AÃE", son:"https://freesound.org/data/previews/341/341723_6247650-lq.mp3"},
  12:{action:"Dessine ce que te souffle le joueur Ã  ta gauche", popup:"Draw", son:"https://freesound.org/data/previews/341/341725_6247650-lq.mp3"},
  13:{action:"Pose une colle au joueur de ton choix", popup:"Culture G", son:"https://freesound.org/data/previews/341/341728_6247650-lq.mp3"},
  14:{action:"Embrasse le joueur Ã  ta gauche", popup:"Smak", son:"https://freesound.org/data/previews/341/341730_6247650-lq.mp3"},
  15:{action:"Ã‰change un vÃªtement avec le joueur Ã  ta droite", popup:"Ã‰change", son:"https://freesound.org/data/previews/341/341733_6247650-lq.mp3"},
  16:{action:"Passe ton tour ! Et bois un coup tant qu'Ã  faire :)", popup:"Stop!", son:"https://freesound.org/data/previews/341/341735_6247650-lq.mp3"},
  17:{action:"Ã‰change ton verre avec le joueur Ã  ta gauche", popup:"C'est bon...ou pas!", son:"https://freesound.org/data/previews/341/341738_6247650-lq.mp3"},
  18:{action:"Dessine ce que te souffle le joueur Ã  ta droite", popup:"Draw", son:"https://freesound.org/data/previews/341/341740_6247650-lq.mp3"},
  19:{action:"Avance de trois cases ... je pense que tu avais soif :)", popup:"tchou tchou glou glou", son:"https://freesound.org/data/previews/341/341743_6247650-lq.mp3"},
  20:{action:"Fredonne la chanson que te souffle le joueur Ã  ta gauche", popup:"Met l'ambiance !", son:"https://freesound.org/data/previews/341/341745_6247650-lq.mp3"},
  21:{action:"Pose une question osÃ©e au joueur de ton choix", popup:"Indiscretions", son:"https://freesound.org/data/previews/341/341748_6247650-lq.mp3"},
  22:{action:"Cul sec !", popup:"Glou glou", son:"https://freesound.org/data/previews/341/341750_6247650-lq.mp3"},
  23:{action:"Mime ce que te souffle le joueur Ã  ta gauche", popup:"Action!", son:"https://freesound.org/data/previews/341/341753_6247650-lq.mp3"},
  24:{action:"Pose une colle au joueur de ton choix", popup:"Culture G", son:"https://freesound.org/data/previews/341/341755_6247650-lq.mp3"},
  25:{action:"Tu as gagnÃ© le droit de demander le service que tu veux au joueur de ton choix", popup:"Winner!!!", son:"https://freesound.org/data/previews/341/341757_6247650-lq.mp3"}
};

/* ---------- State ---------- */
const boardWrap = document.getElementById('boardWrap');
const boardPopup = document.getElementById('boardPopup');
const bpTitle = document.getElementById('bpTitle');
const bpText = document.getElementById('bpText');
const statusBox = document.getElementById('statusBox');
const numPlayersSel = document.getElementById('numPlayers');
const startBtn = document.getElementById('startBtn');
const rollBtn = document.getElementById('rollBtn');
const resetBtn = document.getElementById('resetBtn');
const volRange = document.getElementById('vol');
const diceDisplay = document.getElementById('diceDisplay');
const playMusicBtn = document.getElementById('playMusicBtn');
const bandeau = document.getElementById('bandeau');

let players = []; // {el, pos}
let currentTurn = 0;
let gameOn = false;
let masterGain = 0.8;
let musicNodes = [];

/* ---------- Audio: simple music + play sound helper ---------- */
let audioCtx = null;
function ensureAudioContext(){
  if(!audioCtx){
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
}

/* Chill music generator (simple pad loop) */
function startMusic(){
  ensureAudioContext();
  stopMusic();
  // few oscillators with slow LFOs
  const notes = [220, 277.18, 329.63]; // A3, C#4, E4-ish
  notes.forEach((freq, i)=>{
    const osc = audioCtx.createOscillator();
    osc.type = 'sine';
    osc.frequency.value = freq;
    const g = audioCtx.createGain(); g.gain.value = 0;
    const lfo = audioCtx.createOscillator(); lfo.frequency.value = 0.05 + i*0.01; lfo.type='sine';
    const lfoGain = audioCtx.createGain(); lfoGain.gain.value = 0.06;
    lfo.connect(lfoGain); lfoGain.connect(g.gain);
    osc.connect(g); g.connect(audioCtx.destination);
    osc.start(); lfo.start();
    g.gain.linearRampToValueAtTime(0.12, audioCtx.currentTime + 1.5 + i*0.2);
    musicNodes.push({osc,lfo,g});
  });
}
function stopMusic(){
  musicNodes.forEach(n=>{
    try{ n.osc.stop(); n.lfo.stop(); }catch(e){}
  });
  musicNodes=[];
}

/* Play small sfx via <audio> for compatibility */
function playSfx(url){
  try{
    const a = new Audio(url);
    a.volume = masterGain;
    a.play().catch(()=>{/* might be blocked until user gesture */});
  }catch(e){}
}

/* ---------- Helpers ---------- */
function setStatus(text){ statusBox.textContent = text; }
function showBoardPopup(caseNum){
  const coord = caseCoords[caseNum-1];
  const left = coord.x;
  const top = coord.y;
  bpTitle.textContent = caseData[caseNum].popup || "";
  bpText.textContent = caseData[caseNum].action || "";
  boardPopup.style.left = (left) + 'px';
  boardPopup.style.top = (top) + 'px';
  boardPopup.style.display = 'block';
  // hide after 4.5s
  setTimeout(()=>{ boardPopup.style.display = 'none'; }, 4500);
}

/* Ensure pawns don't overlap: compute offset by number of players on same case */
function placeAllPawns(){
  const counts = {}; // caseNum -> array of player indexes
  players.forEach((p, idx)=>{
    counts[p.pos] = counts[p.pos] || [];
    counts[p.pos].push(idx);
  });
  // for each case, place players with small grid around center
  Object.keys(counts).forEach(key=>{
    const idxs = counts[key];
    const base = caseCoords[key-1];
    // grid layout (max 6 players)
    const offsets = [
      [-18,-12],[18,-12],[-18,12],[18,12],[-36,0],[36,0]
    ];
    idxs.forEach((playerIndex, i)=>{
      const off = offsets[i] || [ (i%2)*20, Math.floor(i/2)*20 ];
      const el = players[playerIndex].el;
      el.style.left = (base.x + off[0]) + 'px';
      el.style.top  = (base.y + off[1]) + 'px';
    });
  });
}

/* Show banner action (bandeau) â€” stays until next action */
function showBanner(caseNum, playerIndex){
  const d = caseData[caseNum];
  bandeau.textContent = `Joueur ${playerIndex+1} â€” Case ${caseNum} : ${d.popup} â€” ${d.action}`;
}

/* ---------- Game flow ---------- */
function createPlayers(n){
  // clear existing pawns in DOM
  document.querySelectorAll('.pawn').forEach(el=>el.remove());
  players = [];
  for(let i=0;i<n;i++){
    const div = document.createElement('div');
    div.className = 'pawn';
    div.textContent = (i+1);
    // nice colours
    const cols = ['#e74c3c','#3498db','#2ecc71','#f39c12','#9b59b6','#e67e22'];
    div.style.background = cols[i%cols.length];
    boardWrap.appendChild(div);
    players.push({el:div,pos:1});
  }
  placeAllPawns();
}

/* Start button */
startBtn.addEventListener('click', ()=>{
  // start audio context on user gesture
  ensureAudioContext();
  masterGain = volRange.value/100;
  // start music
  startMusic();
  // create players
  const n = parseInt(numPlayersSel.value,10);
  createPlayers(n);
  currentTurn = 0;
  gameOn = true;
  rollBtn.disabled = false;
  setStatus('Jeu dÃ©marrÃ© â€” Joueur 1 Ã  jouer');
  // Trigger case 1 action right away and show it in banner
  showBanner(1, 0);
  showBoardPopup(1);
  playSfx(caseData[1].son);
});

/* Roll button: dice animation then move pawn */
rollBtn.addEventListener('click', ()=>{
  if(!gameOn) return;
  rollBtn.disabled = true;
  diceDisplay.textContent = '...';
  // animated roll: show 12 random faces then final
  let iter = 0;
  const interval = setInterval(()=>{
    const face = Math.floor(Math.random()*6)+1;
    diceDisplay.textContent = 'ðŸŽ² ' + face;
    iter++;
    if(iter>12){
      clearInterval(interval);
      const final = face;
      // move current player by final
      moveCurrentPlayer(final);
    }
  },100);
});

/* Move logic */
function moveCurrentPlayer(steps){
  const p = players[currentTurn];
  let newPos = p.pos + steps;
  if(newPos > 25) newPos = 25;
  // apply basic move
  p.pos = newPos;
  // check special cases
  // if landed on 11 -> return to 1
  if(p.pos === 11){
    // show immediate popup and sound for 11, then send to 1
    placeAllPawns();
    showBanner(11, currentTurn);
    showBoardPopup(11);
    playSfx(caseData[11].son);
    setTimeout(()=>{
      p.pos = 1;
      placeAllPawns();
      showBanner(1, currentTurn);
      showBoardPopup(1);
      playSfx(caseData[1].son);
      // end turn after popup
      endTurn();
    }, 900);
    return;
  }
  // if landed on 19 -> advance +3
  if(p.pos === 19){
    placeAllPawns();
    showBanner(19, currentTurn);
    showBoardPopup(19);
    playSfx(caseData[19].son);
    setTimeout(()=>{
      p.pos = Math.min(25, p.pos + 3);
      placeAllPawns();
      showBanner(p.pos, currentTurn);
      showBoardPopup(p.pos);
      playSfx(caseData[p.pos].son);
      endTurn();
    }, 900);
    return;
  }

  // normal case: place, show action
  placeAllPawns();
  showBanner(p.pos, currentTurn);
  showBoardPopup(p.pos);
  playSfx(caseData[p.pos].son);

  // victory?
  if(p.pos === 25){
    setStatus(`Joueur ${currentTurn+1} a gagnÃ© !`);
    playSfx(caseData[25].son);
    gameOn = false;
    rollBtn.disabled = true;
    stopMusic();
    return;
  }

  // end turn after a small delay so popup is visible
  setTimeout(()=>{ endTurn(); }, 900);
}

function endTurn(){
  // next player
  currentTurn = (currentTurn + 1) % players.length;
  setStatus(`Tour: Joueur ${currentTurn+1}`);
  rollBtn.disabled = false;
}

/* Reset */
resetBtn.addEventListener('click', ()=>{
  // remove pawns
  document.querySelectorAll('.pawn').forEach(el=>el.remove());
  players = [];
  gameOn = false;
  rollBtn.disabled = true;
  diceDisplay.textContent = 'â€”';
  setStatus('RÃ©initialisÃ©.');
  boardPopup.style.display = 'none';
  stopMusic();
});

/* Volume control */
volRange.addEventListener('input', ()=>{
  masterGain = volRange.value/100;
});

/* play music button (manual) */
playMusicBtn.addEventListener('click', ()=>{
  ensureAudioContext();
  if(musicNodes.length) { stopMusic(); playMusicBtn.textContent = 'Play'; }
  else { startMusic(); playMusicBtn.textContent = 'Stop'; }
});

/* Ensure initial message */
setStatus('PrÃªt. Choisis le nombre de joueurs et clique Start.');

/* Accessibility: allow hitting Enter to roll when enabled */
document.addEventListener('keydown', e=>{
  if(e.key === 'Enter' && !rollBtn.disabled){ rollBtn.click(); }
});
</script>
</body>
</html>
